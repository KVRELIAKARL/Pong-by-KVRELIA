<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Pong By KVRELIA</title>
  <style>
    :root {
      --systemBlue: #007AFF;
      --systemGray6: #F2F2F7;
      --systemGray5: #E5E5EA;
      --systemGray4: #D1D1D6;
      --systemGray3: #C7C7CC;
      --systemGray2: #AEAEB2;
      --systemGray: #8E8E93;
      --labelPrimary: #000000;
      --systemBackground: #ffffff;
      --paddleGlow: 0 0 8px rgba(255, 255, 255, 0.5);
      --ballGlow: 0 0 12px rgba(0, 122, 255, 0.7);
    }

    :root.developer-mode {
      --systemBackground: #000000;
      --labelPrimary: #00FF41;
      --systemBlue: #00FF41;
      --systemGray6: #000000;
      --systemGray5: #000000;
      --systemGray4: #003B00;
      --systemGray3: #008F11;
      --systemGray2: #00FF41;
      --systemGray: #00FF41;
      --paddleGlow: 0 0 8px rgba(0, 255, 65, 0.7);
      --ballGlow: 0 0 12px rgba(0, 255, 65, 0.9);
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
      20%, 40%, 60%, 80% { transform: translateX(8px); }
    }

    @keyframes slideInRight {
      from { transform: translateX(100px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes textTyping {
      from { width: 0; }
      to { width: 100%; }
    }

    @keyframes characterBounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-15px) rotate(5deg); }
      50% { transform: translateY(0) rotate(0deg); }
      75% { transform: translateY(-8px) rotate(-5deg); }
    }

    @keyframes characterFlustered {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15) rotate(8deg); }
    }

    @keyframes characterNervous {
      0%, 100% { transform: translateX(0) rotate(0deg); }
      25% { transform: translateX(-5px) rotate(-3deg); }
      50% { transform: translateX(5px) rotate(3deg); }
      75% { transform: translateX(-5px) rotate(-3deg); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    @keyframes characterHide {
      0% { transform: translateY(0); }
      100% { transform: translateY(var(--hide-offset)); }
    }

    @keyframes characterPeek {
      0%, 100% { transform: translateY(var(--hide-offset)); }
      50% { transform: translateY(calc(var(--hide-offset) - 50px)); }
    }

    @keyframes paddleDynamicMove {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.05) rotate(2deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    @keyframes ballPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes commentBoxAppear {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes matrix-fall {
      0% {
        transform: translateY(-100%);
        opacity: 0;
      }
      5% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(100vh);
        opacity: 0;
      }
    }

    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--systemBackground);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif;
      overflow: hidden;
      cursor: default;
      color: var(--labelPrimary);
      touch-action: manipulation;
    }

    .developer-mode body {
      background: #000;
      position: relative;
      overflow: hidden;
    }

    .matrix-rain {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
      display: none;
    }

    .developer-mode .matrix-rain {
      display: block;
    }

    .matrix-column {
      position: absolute;
      top: 0;
      width: 1em;
      height: 100%;
      color: #00FF41;
      font-size: 16px;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      text-shadow: 0 0 5px #00FF41;
      animation: matrix-fall linear infinite;
    }

    .start-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--systemGray6);
      border-radius: 14px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.04);
      max-width: 90%;
      width: 90%;
      text-align: center;
      z-index: 30;
      transition: all 0.5s cubic-bezier(0.28, 0.11, 0.32, 1);
      will-change: transform, opacity;
    }

    .developer-mode .start-screen {
      background: #000;
      border-color: #003B00;
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
    }

    .start-screen.slide-out {
      transform: translateX(-100vw);
      opacity: 0;
    }

    .start-screen h1 {
      font-size: 2.5rem;
      margin: 0 0 20px;
      font-weight: 700;
      background: linear-gradient(90deg, #FF5F6D, #FFC371, #4CAF50, #2196F3, #9C27B0, #FF5F6D);
      background-size: 400% 400%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: gradient 8s ease infinite, fadeIn 1.5s ease-out forwards;
      opacity: 0;
    }

    .developer-mode .start-screen h1 {
      background: linear-gradient(90deg, #00FF41, #00FF88, #00FF41);
      background-size: 200% 200%;
      animation: gradient 4s ease infinite, fadeIn 1.5s ease-out forwards;
    }

    .start-screen input {
      padding: 12px;
      font-size: 1.2rem;
      border: 1px solid var(--systemGray4);
      border-radius: 10px;
      margin-bottom: 20px;
      width: 80%;
      max-width: 280px;
      background: white;
      color: var(--labelPrimary);
      outline: none;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
      animation: fadeIn 0.8s ease-out forwards;
      animation-delay: 0.3s;
      opacity: 0;
    }

    .developer-mode .start-screen input {
      background: #000;
      color: #00FF41;
      border-color: #008F11;
    }

    .start-screen input:focus {
      border-color: var(--systemBlue);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    }

    .developer-mode .start-screen input:focus {
      border-color: #00FF41;
      box-shadow: 0 0 0 4px rgba(0, 255, 65, 0.3);
    }

    .start-screen input::placeholder {
      color: var(--systemGray);
    }

    .developer-mode .start-screen input::placeholder {
      color: #008F11;
    }

    .start-screen button {
      background: var(--systemBlue);
      color: #FFFFFF;
      border: none;
      padding: 14px 28px;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
      animation: fadeIn 0.8s ease-out forwards;
      animation-delay: 0.6s;
      opacity: 0;
      width: 80%;
      max-width: 200px;
    }

    .developer-mode .start-screen button {
      background: #003B00;
      color: #00FF41;
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }

    .start-screen button:hover {
      background: #0062CC;
      transform: scale(1.03);
    }

    .developer-mode .start-screen button:hover {
      background: #008F11;
    }

    .tutorial-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 100;
      background: var(--systemGray6);
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.5s cubic-bezier(0.28, 0.11, 0.32, 1);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .developer-mode .tutorial-container {
      background: #000;
    }

    .tutorial-container.active {
      display: flex;
      opacity: 1;
    }

    .tutorial-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 100%;
      width: 90%;
      padding: 20px 0;
      animation: scaleIn 0.5s cubic-bezier(0.28, 0.11, 0.32, 1) forwards;
    }

    .tutorial-character-container {
      position: relative;
      width: 300px;
      height: 420px;
      margin-bottom: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .tutorial-character {
      position: relative;
      width: 100%;
      height: 100%;
      animation: characterBounce 3s infinite ease-in-out;
      cursor: pointer;
    }

    .tutorial-character img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .tutorial-character.happy {
      animation: characterBounce 2s infinite ease-in-out;
    }

    .tutorial-character.annoyed {
      animation: shake 0.5s infinite ease-in-out;
    }

    .tutorial-character.sarcastic {
      animation: characterBounce 1.5s infinite ease-in-out;
    }

    .tutorial-character.nervous {
      animation: characterNervous 0.5s infinite ease-in-out;
    }

    .tutorial-character.flustered {
      animation: characterFlustered 0.8s infinite ease-in-out;
    }

    .tutorial-character.excited {
      animation: float 2s infinite ease-in-out;
    }

    .tutorial-character.serious {
      animation: none;
      transform: scale(1);
    }

    .tutorial-character.hidden {
      animation: characterHide 0.5s forwards, characterPeek 2s infinite ease-in-out 0.5s;
    }

    .tutorial-dialogue-container {
      flex: 1;
      min-width: 0;
      width: 90%;
    }

    .tutorial-dialogue {
      background: white;
      border-radius: 14px;
      padding: 20px;
      width: 100%;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.04);
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.28, 0.11, 0.32, 1);
      min-height: 150px;
      display: flex;
      flex-direction: column;
    }

    .developer-mode .tutorial-dialogue {
      background: #000;
      border-color: #008F11;
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
    }

    .tutorial-dialogue.active {
      transform: translateY(0);
      opacity: 1;
    }

    .tutorial-speaker {
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--systemBlue);
      font-size: 1.4rem;
      display: flex;
      align-items: center;
    }

    .developer-mode .tutorial-speaker {
      color: #00FF41;
    }

    .tutorial-speaker::before {
      content: "";
      display: inline-block;
      width: 10px;
      height: 10px;
      background-color: var(--systemBlue);
      border-radius: 50%;
      margin-right: 10px;
    }

    .developer-mode .tutorial-speaker::before {
      background-color: #00FF41;
    }

    .tutorial-text-container {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    .tutorial-text {
      font-size: 1.4rem;
      line-height: 1.5;
      margin: 0;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      white-space: pre-wrap;
      overflow: hidden;
      border-right: 3px solid var(--systemBlue);
      animation: textTyping 3s steps(40, end);
      min-height: 100%;
      display: inline-block;
      font-weight: 500;
    }

    .developer-mode .tutorial-text {
      color: #00FF41;
      border-right-color: #00FF41;
    }

    .tutorial-controls {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }

    .tutorial-button {
      background: var(--systemBlue);
      color: #FFFFFF;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
      width: 100%;
      max-width: 100px;
    }

    .developer-mode .tutorial-button {
      background: #003B00;
      color: #00FF41;
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }

    .tutorial-button:hover {
      background: #0062CC;
      transform: scale(1.03);
    }

    .developer-mode .tutorial-button:hover {
      background: #008F11;
    }

    .container {
      display: none;
      background: var(--systemGray6);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.04);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      position: relative;
      transform: translateX(100vw);
      transition: all 0.6s cubic-bezier(0.28, 0.11, 0.32, 1);
      will-change: transform, opacity;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .developer-mode .container {
      background: #000;
      border-color: #008F11;
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
    }

    .container.slide-in {
      transform: translateX(0);
      opacity: 1;
    }

    .game-container {
      display: none;
      position: relative;
      width: 100%;
      height: 60vh;
      min-height: 400px;
      background: linear-gradient(180deg, #1C2526, #2D3839);
      border-radius: 10px;
      overflow: hidden;
      touch-action: none;
      box-shadow: inset 0 2px 20px rgba(0, 0, 0, 0.3);
    }

    .developer-mode .game-container {
      background: linear-gradient(180deg, #000, #000);
      box-shadow: inset 0 0 30px rgba(0, 255, 65, 0.2);
    }

    .paddle {
      position: absolute;
      width: 12px;
      height: 80px;
      background: linear-gradient(90deg, #FFFFFF, #D1D1D6);
      border-radius: 6px;
      transition: top 0.1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: var(--paddleGlow);
    }

    .developer-mode .paddle {
      background: linear-gradient(90deg, #00FF41, #00FF88);
    }

    #playerPaddle {
      left: 15px;
      top: 0;
    }

    #aiPaddle {
      right: 15px;
      top: 0;
    }

    .paddle.active {
      animation: paddleDynamicMove 0.3s ease-out;
    }

    .ball {
      position: absolute;
      width: 15px;
      height: 15px;
      background: var(--systemBlue);
      border-radius: 50%;
      box-shadow: var(--ballGlow);
      animation: ballPulse 0.1s infinite ease-in-out;
    }

    .developer-mode .ball {
      background: #00FF41;
    }

    .score {
      position: absolute;
      color: var(--systemGray6);
      font-size: 2rem;
      font-weight: 600;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      opacity: 0.9;
      transition: transform 0.3s ease-out;
    }

    .developer-mode .score {
      color: #00FF41;
      text-shadow: 0 0 10px rgba(0, 255, 65, 0.7);
    }

    .score.bounce {
      transform: scale(1.2);
      transition: transform 0.2s ease-out;
    }

    #playerScore {
      left: 20%;
      top: 20px;
    }

    #aiScore {
      right: 20%;
      top: 20px;
    }

    .bot-selection {
      text-align: center;
      width: 100%;
    }

    .bot-selection h2 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      font-weight: 700;
      color: var(--labelPrimary);
    }

    .developer-mode .bot-selection h2 {
      color: #00FF41;
    }

    .bot-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-top: 15px;
      width: 100%;
    }

    .bot-card {
      background: white;
      border-radius: 14px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.28, 0.11, 0.32, 1);
      width: 80%;
      max-width: 300px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .developer-mode .bot-card {
      background: #000;
      border-color: #008F11;
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
    }

    .bot-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    .developer-mode .bot-card:hover {
      box-shadow: 0 0 25px rgba(0, 255, 65, 0.5);
    }

    .bot-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
    }

    .bot-card p {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0;
      color: var(--labelPrimary);
    }

    .developer-mode .bot-card p {
      color: #00FF41;
    }

    .achievements-button {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--systemBlue);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
      z-index: 10;
    }

    .developer-mode .achievements-button {
      background: #003B00;
      color: #00FF41;
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }

    .achievements-button:hover {
      background: #0062CC;
      transform: scale(1.03);
    }

    .developer-mode .achievements-button:hover {
      background: #008F11;
    }

    .leave-button {
      position: absolute;
      top: 15px;
      left: 15px;
      background: var(--systemGray);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
      z-index: 10;
    }

    .developer-mode .leave-button {
      background: #003B00;
      color: #00FF41;
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }

    .leave-button:hover {
      background: #7A7A7E;
      transform: scale(1.03);
    }

    .developer-mode .leave-button:hover {
      background: #008F11;
    }

    .achievements-container {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      z-index: 20;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow-y: auto;
    }

    .developer-mode .achievements-container {
      background: rgba(0, 0, 0, 0.95);
    }

    .achievements-container.active {
      display: flex;
    }

    .achievement {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      width: 80%;
      max-width: 400px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.04);
    }

    .developer-mode .achievement {
      background: #000;
      border-color: #008F11;
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
    }

    .achievement h3 {
      margin: 0 0 10px;
      font-size: 1.4rem;
      color: var(--systemBlue);
    }

    .developer-mode .achievement h3 {
      color: #00FF41;
    }

    .achievement p {
      margin: 0;
      font-size: 1.2rem;
      color: var(--labelPrimary);
    }

    .developer-mode .achievement p {
      color: #00FF41;
    }

    .touch-controls {
      display: none;
      position: absolute;
      bottom: 20px;
      left: 0;
      width: 100%;
      justify-content: center;
      gap: 20px;
      z-index: 5;
    }

    .developer-mode .touch-controls {
      bottom: 70px;
    }

    .touch-button {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
      color: white;
      touch-action: manipulation;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease-out;
    }

    .developer-mode .touch-button {
      background: rgba(0, 255, 65, 0.3);
      box-shadow: 0 0 15px rgba(0, 255, 65, 0.5);
    }

    .touch-button:active {
      transform: scale(0.95);
    }

    .comment-box {
      display: none;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 15px;
      margin-top: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      width: 100%;
      max-width: 760px;
      opacity: 0;
      transform: translateY(10px) scale(0.95);
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .developer-mode .comment-box {
      background: rgba(0, 13, 8, 0.9);
      border-color: rgba(0, 255, 65, 0.2);
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
    }

    .comment-box.active {
      display: flex;
      opacity: 1;
      transform: translateY(0) scale(1);
      animation: commentBoxAppear 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .comment-box.game-result {
      animation: none;
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .comment-character {
      width: 80px;
      height: 112px;
      margin-right: 15px;
    }

    .comment-character img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .comment-character.happy {
      animation: characterBounce 2s infinite ease-in-out;
    }

    .comment-character.nervous {
      animation: characterNervous 0.5s infinite ease-in-out;
    }

    .comment-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .comment-speaker {
      font-weight: 700;
      color: var(--systemBlue);
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    .developer-mode .comment-speaker {
      color: #00FF41;
    }

    .comment-text {
      font-size: 1.1rem;
      color: var(--labelPrimary);
      margin: 0;
      white-space: pre-wrap;
    }

    .developer-mode .comment-text {
      color: #00FF41;
    }

    .password-container {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 500px;
      margin-top: 20px;
    }

    .password-container.active {
      display: flex;
    }

    .password-input {
      padding: 12px;
      font-size: 1.2rem;
      border: 1px solid var(--systemGray4);
      border-radius: 10px;
      margin-bottom: 15px;
      width: 80%;
      max-width: 280px;
      background: white;
      color: var(--labelPrimary);
      outline: none;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
    }

    .developer-mode .password-input {
      background: #000;
      color: #00FF41;
      border-color: #008F11;
    }

    .password-input:focus {
      border-color: var(--systemBlue);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    }

    .developer-mode .password-input:focus {
      border-color: #00FF41;
      box-shadow: 0 0 0 4px rgba(0, 255, 65, 0.3);
    }

    .password-button {
      background: var(--systemBlue);
      color: #FFFFFF;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
      width: 80%;
      max-width: 100px;
    }

    .developer-mode .password-button {
      background: #003B00;
      color: #00FF41;
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
    }

    .password-button:hover {
      background: #0062CC;
      transform: scale(1.03);
    }

    .developer-mode .password-button:hover {
      background: #008F11;
    }

    .error-message {
      color: #FF3B30;
      font-size: 1.2rem;
      margin-top: 10px;
      text-align: center;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
    }

    .developer-mode .error-message {
      color: #FF5555;
    }

    .error-message.active {
      opacity: 1;
      transform: translateY(0);
    }

    .ai-controls {
      display: none;
      position: absolute;
      bottom: 20px;
      left: 0;
      width: 100%;
      justify-content: center;
      gap: 10px;
      z-index: 5;
      padding: 10px;
    }

    .developer-mode .ai-controls {
      display: flex;
    }

    .ai-control-button {
      background: rgba(0, 255, 65, 0.3);
      color: #00FF41;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.28, 0.11, 0.32, 1);
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
    }

    .ai-control-button:hover {
      background: rgba(0, 255, 65, 0.5);
      transform: scale(1.03);
    }

    @media (min-width: 768px) {
      .start-screen {
        padding: 40px;
        max-width: 500px;
      }
      
      .start-screen h1 {
        font-size: 3rem;
      }
      
      .tutorial-content {
        flex-direction: row;
        align-items: center;
        max-width: 900px;
      }
      
      .tutorial-character-container {
        width: 350px;
        height: 500px;
        margin-right: 40px;
        margin-bottom: 0;
      }
      
      .tutorial-dialogue {
        max-width: 500px;
        padding: 30px;
      }
      
      .tutorial-speaker {
        font-size: 1.6rem;
      }
      
      .tutorial-text {
        font-size: 1.6rem;
      }
      
      .bot-container {
        flex-direction: row;
        justify-content: center;
      }
      
      .bot-card {
        width: 200px;
        padding: 20px;
      }
      
      .bot-card img {
        width: 100px;
        height: 100px;
      }
      
      .paddle {
        width: 15px;
        height: 100px;
      }
      
      .ball {
        width: 20px;
        height: 20px;
      }
      
      .score {
        font-size: 2.5rem;
      }

      .comment-character {
        width: 100px;
        height: 140px;
      }

      .ai-controls {
        gap: 20px;
      }

      .ai-control-button {
        padding: 10px 20px;
        font-size: 1rem;
      }
    }

    @media (min-width: 1024px) {
      .tutorial-character-container {
        width: 400px;
        height: 600px;
      }
      
      .tutorial-dialogue {
        max-width: 600px;
      }
      
      .game-container {
        height: 70vh;
      }
    }
  </style>
</head>
<body>
  <div class="matrix-rain" id="matrixRain"></div>
  <div class="start-screen" id="startScreen">
    <h1>Pong By KVRELIA</h1>
    <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="20" aria-label="Player name input">
    <button id="startButton" aria-label="Start game">Start</button>
  </div>

  <div class="tutorial-container" id="tutorialContainer">
    <div class="tutorial-content">
      <div class="tutorial-character-container">
        <div class="tutorial-character" id="tutorialCharacter">
          <img id="tutorialCharacterImage" src="https://i.imgur.com/C60VL7M.png" alt="Hina Pon">
        </div>
      </div>
      <div class="tutorial-dialogue-container">
        <div class="tutorial-dialogue" id="tutorialDialogue">
          <div class="tutorial-speaker" id="tutorialSpeaker">Hina Pon</div>
          <div class="tutorial-text-container">
            <div class="tutorial-text" id="tutorialText"></div>
          </div>
          <div class="tutorial-controls" id="tutorialControls">
            <button class="tutorial-button" id="tutorialNextButton">Continue</button>
          </div>
          <div class="password-container" id="passwordContainer">
            <input type="text" id="passwordInput" class="password-input" placeholder="Enter password" maxlength="20" aria-label="Password input">
            <button class="password-button" id="passwordButton" aria-label="Submit password">Submit</button>
            <div class="error-message" id="errorMessage">Wrong key, coder! Try again—no stack overflow allowed!</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container" id="mainContainer">
    <button class="achievements-button" id="achievementsButton" onclick="toggleAchievements()" aria-label="Open achievements">Achievements</button>
    <div class="bot-selection" id="botSelection">
      <h2>Select Your Opponent</h2>
      <div class="bot-container" id="botContainer">
        <div class="bot-card" data-bot="1">
          <img src="https://i.imgur.com/0mUKe7Y.png" alt="Your Grandpa">
          <p>Your Grandpa</p>
        </div>
        <div class="bot-card" data-bot="2">
          <img src="https://i.imgur.com/vaAusAL.png" alt="Normal AI">
          <p>Normal AI</p>
        </div>
        <div class="bot-card" data-bot="3">
          <img src="https://i.imgur.com/q7E4DpM.png" alt="Rich CEO">
          <p>Rich CEO</p>
        </div>
      </div>
    </div>
    <div class="game-container" id="gameContainer">
      <button class="leave-button" id="leaveButton" aria-label="Leave game">Leave Game</button>
      <div class="paddle" id="playerPaddle"></div>
      <div class="paddle" id="aiPaddle"></div>
      <div class="ball" id="ball"></div>
      <div class="score" id="playerScore">0</div>
      <div class="score" id="aiScore">0</div>
      <div class="touch-controls" id="touchControls">
        <div class="touch-button" id="upButton">↑</div>
        <div class="touch-button" id="downButton">↓</div>
      </div>
      <div class="ai-controls" id="aiControls">
        <button class="ai-control-button" id="aiEasierButton">Easier AI</button>
        <button class="ai-control-button" id="aiHarderButton">Harder AI</button>
        <button class="ai-control-button" id="aiPreciseButton">Precise AI</button>
        <button class="ai-control-button" id="aiRandomButton">Random AI</button>
      </div>
    </div>
    <div class="comment-box" id="commentBox">
      <div class="comment-character" id="commentCharacter">
        <img id="commentCharacterImage" src="https://i.imgur.com/C60VL7M.png" alt="Hina Pon">
      </div>
      <div class="comment-content">
        <div class="comment-speaker" id="commentSpeaker">Hina Pon</div>
        <p class="comment-text" id="commentText"></p>
      </div>
    </div>
    <div class="achievements-container" id="achievementsContainer">
      <h2>Achievements</h2>
      <div id="achievementList"></div>
      <button class="tutorial-button" onclick="toggleAchievements()">Close</button>
    </div>
  </div>

  <script>
    // Game variables
    let playerName = 'Player';
    let isCharacterHidden = false;
    let developerMode = false;
    const playerNameInput = document.getElementById('playerNameInput');
    const startButton = document.getElementById('startButton');
    const startScreen = document.getElementById('startScreen');
    const mainContainer = document.getElementById('mainContainer');
    const botContainer = document.getElementById('botContainer');
    const botCards = document.querySelectorAll('.bot-card');
    const gameContainer = document.getElementById('gameContainer');
    const botSelection = document.getElementById('botSelection');
    const touchControls = document.getElementById('touchControls');
    const upButton = document.getElementById('upButton');
    const downButton = document.getElementById('downButton');
    const leaveButton = document.getElementById('leaveButton');
    const matrixRain = document.getElementById('matrixRain');
    const aiControls = document.getElementById('aiControls');
    const aiEasierButton = document.getElementById('aiEasierButton');
    const aiHarderButton = document.getElementById('aiHarderButton');
    const aiPreciseButton = document.getElementById('aiPreciseButton');
    const aiRandomButton = document.getElementById('aiRandomButton');

    // AI difficulty modifiers
    let aiDifficultyModifier = 1.0;
    let aiPrecisionModifier = 1.0;
    let aiRandomnessModifier = 0.0;

    // Pong game elements
    const playerPaddle = document.getElementById('playerPaddle');
    const aiPaddle = document.getElementById('aiPaddle');
    const ball = document.getElementById('ball');
    const playerScore = document.getElementById('playerScore');
    const aiScore = document.getElementById('aiScore');

    // Tutorial elements
    const tutorialContainer = document.getElementById('tutorialContainer');
    const tutorialCharacter = document.getElementById('tutorialCharacter');
    const tutorialCharacterImage = document.getElementById('tutorialCharacterImage');
    const tutorialDialogue = document.getElementById('tutorialDialogue');
    const tutorialSpeaker = document.getElementById('tutorialSpeaker');
    const tutorialText = document.getElementById('tutorialText');
    const tutorialControls = document.getElementById('tutorialControls');
    const tutorialNextButton = document.getElementById('tutorialNextButton');
    const passwordContainer = document.getElementById('passwordContainer');
    const passwordInput = document.getElementById('passwordInput');
    const passwordButton = document.getElementById('passwordButton');
    const errorMessage = document.getElementById('errorMessage');

    // Comment box elements
    const commentBox = document.getElementById('commentBox');
    const commentCharacter = document.getElementById('commentCharacter');
    const commentCharacterImage = document.getElementById('commentCharacterImage');
    const commentSpeaker = document.getElementById('commentSpeaker');
    const commentText = document.getElementById('commentText');

    // Achievements elements
    const achievementsContainer = document.getElementById('achievementsContainer');
    const achievementList = document.getElementById('achievementList');

    // Tutorial scripts
    const normalTutorialScript = [
      { text: "Welcome to the tutorial!", emotion: "happy" },
      { text: "Oh. I mean, Pong is literally the easiest thing in the world, but, just... Yes. Tutorial!", emotion: "annoyed" },
      { text: "Don't you just love having to do tutorials in games you have played before and already know by heart!", emotion: "sarcastic" },
      { text: "hehehe… You do not need this long tutorial you know?", emotion: "happy" },
      { text: "I'm just going to constantly bug you about how you need to listen to this tutorial.", emotion: "sarcastic" },
      { text: "eh...eh...((cough) (Cough) totally not what I'm doing right now.)", emotion: "nervous" },
      { text: "Anyway, KVRELIAKVRI Designed this model in like 4 days using- What? I have to actually do a tutorial? Oh- Right. Anyway,", emotion: "flustered" },
      { text: "Let's get started with the actual tutorial... ((even though you probably don't need it)", emotion: "normal" },
      { text: "Use your mouse or touch controls to move the paddle up and down. The goal is to hit the ball past your opponent.", emotion: "explaining" },
      { text: "There are different AI opponents with varying difficulty levels. Choose wisely!", emotion: "serious" },
      { text: "That's it!", emotion: "excited" },
      { text: "Wait, did you actually listen to all of that? I'm impressed!", emotion: "happy" },
      { text: "Or maybe you just skipped through... either way, let's play!", emotion: "sarcastic" }
    ];

    const developerTutorialScript = [
      { text: "01001000 01101001 00100001 00100000 01001001 00100111 01101101 00100000 01001000 01100001 01101110 01100001 00100000 01010000 01101111 01101110 01101011 01101111 00101110 00100000 01010111 01100101 01101100 01100011 01101111 01101101 01100101 00100000 01110100 01101111 00100000 01000100 01100101 01110110 01100101 01101100 01101111 01110000 01100101 01110010 00100000 01001101 01101111 01100100 01100101 00100001", emotion: "serious" },
      { text: "*static* Wait, let me switch to human-readable mode... *beep boop* There we go!", emotion: "flustered" },
      { text: "Welcome to Developer Mode! I'm Hana Ponko, your debug companion. I'm 87.3% more efficient than the regular tutorial character.", emotion: "happy" },
      { text: "This mode has all sorts of fun behind-the-scenes stuff. Matrix rain? Check. AI controls? Check. Glitchy dialogue? *static* Oops, that wasn't supposed to happen.", emotion: "nervous" },
      { text: "The AI opponents here are... different. Grandpa has machine learning now. The 'Normal' AI is anything but normal. And the CEO? Let's just say he's been... optimized.", emotion: "serious" },
      { text: "You can tweak the AI difficulty in real-time. Make it easier if you're debugging, harder if you're... a masochist?", emotion: "sarcastic" },
      { text: "Oh no, I think I'm leaking memory... *glitch* Just kidding! Or am I? *nervous laughter*", emotion: "nervous" },
      { text: "Remember: With great power comes great responsibility. And with developer mode comes the ability to make the AI completely unfair.", emotion: "serious" },
      { text: "The matrix effect is purely cosmetic, but it makes you look 42% cooler. That's a scientifically proven fact. (Not really.)", emotion: "happy" },
      { text: "Now go break things! I mean... test things thoroughly. Yeah. That.", emotion: "flustered" },
      { text: "01000111 01101111 01101111 01100100 00100000 01101100 01110101 01100011 01101011 00100001 00100000 01011001 01101111 01110101 00100111 01101100 01101100 00100000 01101110 01100101 01100101 01100100 00100000 01101001 01110100 00101110", emotion: "serious" }
    ];

    // Bot descriptions for pre-match
    const normalBotDescriptions = {
      1: { text: "This is your Grandpa! He's slow and might miss the ball sometimes, but he's got heart!", emotion: "happy" },
      2: { text: "A-Are you sure? It's actually harder than you think.", emotion: "nervous" },
      3: { text: "Meet the Rich CEO! He's fast and confident, but his arrogance might make him slip up!", emotion: "sarcastic" }
    };

    const developerBotDescriptions = {
      1: { text: "Grandpa's been upgraded with machine learning. He's still slow, but now he can predict your moves with 63.7% accuracy. (Don't ask about the other 36.3%)", emotion: "serious" },
      2: { text: "The 'Normal' AI is now running on a neural network trained on 10,000 Pong matches. It's not normal. It's not even sane anymore.", emotion: "nervous" },
      3: { text: "The Rich CEO invested in performance enhancements. His paddle now moves at 120fps with sub-millisecond latency. Good luck.", emotion: "flustered" }
    };

    // Move comments
    const moveComments = {
      hit: {
        default: ["Nice hit! Keep it up!", "Good one!", "Smooth move!"],
        sana: ["You got it! You're doing so well!", "Nice shot, keep going!", "Great hit, you're amazing!"],
        rsvlt26: ["Solid hit. Try adjusting paddle angle for spin.", "Good contact. Optimize your timing for better control.", "Nice! Consider paddle positioning for trajectory."],
        aiden: ["Oh, you actually hit it? Shocking.", "Finally got one, huh?", "Lucky shot, I guess."]
      },
      miss: {
        default: ["Oof, missed it! Try again!", "Close one! Next time!", "You'll get it next time!"],
        sana: ["Oh, you almost had it! Try again, you're doing great!", "Don't worry, you'll get it next time!", "So close! You're almost there!"],
        rsvlt26: ["Missed. Analyze ball speed and adjust paddle.", "Check your positioning; ball was too fast.", "Missed hit. Debug your paddle movement timing."],
        aiden: ["Missed again? Seriously?", "Wow, that was... not even close.", "Maybe try moving the paddle next time?"]
      },
      score: {
        default: ["Wow, nice shot!", "Point for you!", "Great score!"],
        sana: ["Yay, you scored! You're so good at this!", "Amazing point! Keep shining!", "Wow, that was beautiful!"],
        rsvlt26: ["Score! Leverage paddle hits for consistent points.", "Nice point. Optimize for repeated trajectories.", "Good score. Analyze AI patterns for more."],
        aiden: ["You scored? Must be a glitch.", "Oh, a point? Enjoy it while it lasts.", "Scored, huh? Don't get used to it."]
      },
      concede: {
        default: ["Oh no, hang in there!", "Tough one! Keep trying!", "You'll bounce back!"],
        sana: ["It's okay, you'll get them next time!", "Don't worry, you're still doing great!", "Aww, you'll come back stronger!"],
        rsvlt26: ["Conceded. Study AI paddle movement for counters.", "Point lost. Adjust strategy for ball speed.", "AI scored. Refine your defensive positioning."],
        aiden: ["Let them score again, why don't you?", "Nice job handing them a point.", "What, just giving up now?"]
      }
    };

    let currentTutorialStep = 0;
    let gameActive = false;
    let botDifficulty = 2;
    let gameInterval;
    let ballX = 0;
    let ballY = 0;
    let ballSpeedX = 0;
    let ballSpeedY = 0;
    let playerPaddleY = 0;
    let aiPaddleY = 0;
    let playerScoreValue = 0;
    let aiScoreValue = 0;
    let isMobile = false;
    let touchY = 0;
    let paddleMoveSpeed = 0;
    let characterTouchCount = 0;
    let normalAIConfirmedOnce = false;
    let lastCommentTime = 0;
    let lastBallX = 0;
    let achievements = {
      touchCharacter: { name: "You actually tried this?", description: "Touched the tutorial character.", unlocked: false },
      developerMode: { name: "1337 H4X0R", description: "Unlocked Developer Mode.", unlocked: false }
    };

    // Developer mode character images
    const developerCharacterImageMap = {
      serious: 'https://i.imgur.com/J0sEBnd.png',
      happy: 'https://i.imgur.com/XAPkjGh.png',
      nervous: 'https://i.imgur.com/jrWOK7l.png',
      flustered: 'https://i.imgur.com/h25kRTN.png',
      default: 'https://i.imgur.com/J0sEBnd.png'
    };

    // Normal mode character images
    const normalCharacterImageMap = {
      serious: 'https://i.imgur.com/r0Cxnaw.png',
      flustered: 'https://i.imgur.com/cxszVTW.png',
      sarcastic: 'https://i.imgur.com/DujUpl5.png',
      nervous: 'https://i.imgur.com/zgiro08.png',
      default: 'https://i.imgur.com/C60VL7M.png'
    };

    // Initialize the game
    function initGame() {
      detectMobile();
      startButton.addEventListener('click', startGame);
      playerNameInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') startGame();
      });

      passwordButton.addEventListener('click', verifyPassword);
      passwordInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') verifyPassword();
      });

      botCards.forEach((card, index) => {
        card.querySelector('img').src = [
          "https://i.imgur.com/0mUKe7Y.png",
          "https://i.imgur.com/vaAusAL.png",
          "https://i.imgur.com/q7E4DpM.png"
        ][index];
        card.addEventListener('click', () => {
          botDifficulty = parseInt(card.getAttribute('data-bot'));
          botSelection.style.display = 'none';
          showPreMatchDialogue();
        });
      });

      gameContainer.addEventListener('mousemove', (e) => {
        if (!gameActive || isMobile) return;
        const rect = gameContainer.getBoundingClientRect();
        playerPaddleY = e.clientY - rect.top;
        updatePaddlePosition();
        playerPaddle.classList.add('active');
        setTimeout(() => playerPaddle.classList.remove('active'), 300);
      });

      if (isMobile) {
        gameContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
        gameContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
        
        upButton.addEventListener('touchstart', () => {
          paddleMoveSpeed = -15;
          playerPaddle.classList.add('active');
        });
        
        upButton.addEventListener('touchend', () => {
          paddleMoveSpeed = 0;
          playerPaddle.classList.remove('active');
        });
        
        downButton.addEventListener('touchstart', () => {
          paddleMoveSpeed = 15;
          playerPaddle.classList.add('active');
        });
        
        downButton.addEventListener('touchend', () => {
          paddleMoveSpeed = 0;
          playerPaddle.classList.remove('active');
        });
      }

      leaveButton.addEventListener('click', leaveGame);

      tutorialCharacter.addEventListener('click', handleCharacterTouch);
      tutorialCharacter.addEventListener('touchstart', handleCharacterTouch, { passive: true });

      // AI control buttons
      aiEasierButton.addEventListener('click', () => {
        aiDifficultyModifier = Math.max(0.5, aiDifficultyModifier - 0.1);
        showComment("AI difficulty decreased", "happy");
      });

      aiHarderButton.addEventListener('click', () => {
        aiDifficultyModifier = Math.min(2.0, aiDifficultyModifier + 0.1);
        showComment("AI difficulty increased", "nervous");
      });

      aiPreciseButton.addEventListener('click', () => {
        aiPrecisionModifier = aiPrecisionModifier === 1.0 ? 2.0 : 1.0;
        showComment(`AI precision ${aiPrecisionModifier === 2.0 ? "increased" : "normal"}`, "serious");
      });

      aiRandomButton.addEventListener('click', () => {
        aiRandomnessModifier = aiRandomnessModifier === 0.0 ? 0.5 : 0.0;
        showComment(`AI randomness ${aiRandomnessModifier === 0.5 ? "enabled" : "disabled"}`, "sarcastic");
      });

      updateCharacterHideOffset();
      window.addEventListener('resize', updateCharacterHideOffset);
    }

    function createMatrixRain() {
      const chars = "01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン";
      const columns = Math.floor(window.innerWidth / 20);
      
      for (let i = 0; i < columns; i++) {
        const column = document.createElement('div');
        column.className = 'matrix-column';
        column.style.left = `${i * 20}px`;
        column.style.animationDuration = `${Math.random() * 2000 + 3000}ms`;
        column.style.animationDelay = `${Math.random() * 2000}ms`;
        
        // Fill column with random characters
        let content = '';
        const length = Math.floor(Math.random() * 10) + 10;
        for (let j = 0; j < length; j++) {
          content += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        
        column.textContent = content;
        matrixRain.appendChild(column);
      }
    }

    function updateCharacterHideOffset() {
      const canvasHeight = window.innerHeight;
      const characterHeight = tutorialCharacter.offsetHeight;
      const hideOffset = canvasHeight - characterHeight + 50;
      tutorialCharacter.style.setProperty('--hide-offset', `${hideOffset}px`);
    }

    function detectMobile() {
      isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function handleTouchStart(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = gameContainer.getBoundingClientRect();
      touchY = touch.clientY - rect.top;
    }

    function handleTouchMove(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = gameContainer.getBoundingClientRect();
      touchY = touch.clientY - rect.top;
      playerPaddle.classList.add('active');
      setTimeout(() => playerPaddle.classList.remove('active'), 300);
    }

    function handleCharacterTouch() {
      if (characterTouchCount >= 3) return;

      characterTouchCount++;
      if (characterTouchCount === 1) {
        tutorialCharacter.className = 'tutorial-character annoyed';
        tutorialText.style.animation = 'none';
        void tutorialText.offsetWidth;
        tutorialText.style.animation = 'textTyping 3s steps(40, end)';
        tutorialText.textContent = developerMode ? 
          "*static* Unauthorized physical interaction detected! *beep*" : 
          "Hey! Stop poking me!";
      } else if (characterTouchCount === 2) {
        tutorialCharacter.className = 'tutorial-character flustered';
        tutorialText.style.animation = 'none';
        void tutorialText.offsetWidth;
        tutorialText.style.animation = 'textTyping 3s steps(40, end)';
        tutorialText.textContent = developerMode ? 
          "Warning: Excessive touching may cause system instability. *glitch*" : 
          "Seriously, cut it out!";
      } else {
        tutorialCharacter.className = 'tutorial-character flustered';
        tutorialText.style.animation = 'none';
        void tutorialText.offsetWidth;
        tutorialText.style.animation = 'textTyping 3s steps(40, end)';
        tutorialText.textContent = developerMode ? 
          "Are you trying to trigger a buffer overflow? Because this isn't how that works." : 
          "Oh come on. Are you just doing this because it is an achievement? Shame.";
        if (!achievements.touchCharacter.unlocked) {
          achievements.touchCharacter.unlocked = true;
          updateAchievements();
        }
        setTimeout(() => {
          tutorialCharacter.className = 'tutorial-character hidden';
          isCharacterHidden = true;
          updateTutorialStep();
        }, 1500);
      }

      if (characterTouchCount < 3) {
        setTimeout(() => updateTutorialStep(), 3000);
      }
    }

    function leaveGame() {
      gameActive = false;
      clearInterval(gameInterval);
      gameContainer.style.display = 'none';
      touchControls.style.display = 'none';
      commentBox.classList.remove('active');
      botSelection.style.display = 'block';
    }

    function showPreMatchDialogue() {
      tutorialContainer.classList.add('active');
      tutorialDialogue.classList.add('active');
      normalAIConfirmedOnce = false;
      updatePreMatchDialogue();
    }

    function updatePreMatchDialogue() {
      const botDescriptions = developerMode ? developerBotDescriptions : normalBotDescriptions;
      const desc = botDescriptions[botDifficulty];
      tutorialText.style.animation = 'none';
      void tutorialText.offsetWidth;
      tutorialText.style.animation = 'textTyping 3s steps(40, end)';
      tutorialCharacter.className = `tutorial-character ${desc.emotion}`;
      setCharacterImage(desc.emotion);
      tutorialText.textContent = desc.text;

      tutorialControls.innerHTML = '';
      if (botDifficulty === 2) {
        const yesButton = document.createElement('button');
        yesButton.className = 'tutorial-button';
        yesButton.textContent = 'Yes';
        const noButton = document.createElement('button');
        noButton.className = 'tutorial-button';
        noButton.textContent = 'No';
        tutorialControls.appendChild(yesButton);
        tutorialControls.appendChild(noButton);

        yesButton.addEventListener('click', handleNormalAIYes);
        noButton.addEventListener('click', handleNormalAINo);
      } else {
        const continueButton = document.createElement('button');
        continueButton.className = 'tutorial-button';
        continueButton.textContent = 'Continue';
        tutorialControls.appendChild(continueButton);
        continueButton.addEventListener('click', () => {
          tutorialContainer.classList.remove('active');
          gameContainer.style.display = 'block';
          if (isMobile) {
            touchControls.style.display = 'flex';
          }
          startPongGame();
        });
      }
    }

    function handleNormalAIYes() {
      if (!normalAIConfirmedOnce) {
        normalAIConfirmedOnce = true;
        tutorialText.style.animation = 'none';
        void tutorialText.offsetWidth;
        tutorialText.style.animation = 'textTyping 3s steps(40, end)';
        tutorialText.textContent = developerMode ? 
          "Confirm selection? [Y/N]\nWarning: AI may exhibit unexpected behaviors. *glitch*" : 
          "Are you REAALLY sure?";
        tutorialCharacter.className = 'tutorial-character nervous';
        setCharacterImage('nervous');
        tutorialControls.innerHTML = '';
        const yesButton = document.createElement('button');
        yesButton.className = 'tutorial-button';
        yesButton.textContent = 'Yes';
        const noButton = document.createElement('button');
        noButton.className = 'tutorial-button';
        noButton.textContent = 'No';
        tutorialControls.appendChild(yesButton);
        tutorialControls.appendChild(noButton);

        yesButton.addEventListener('click', () => {
          tutorialContainer.classList.remove('active');
          gameContainer.style.display = 'block';
          if (isMobile) {
            touchControls.style.display = 'flex';
          }
          startPongGame();
        });
        noButton.addEventListener('click', handleNormalAISecondNo);
      }
    }

    function handleNormalAINo() {
      tutorialContainer.classList.remove('active');
      botSelection.style.display = 'block';
    }

    function handleNormalAISecondNo() {
      tutorialText.style.animation = 'none';
      void tutorialText.offsetWidth;
      tutorialText.style.animation = 'textTyping 3s steps(40, end)';
      tutorialText.textContent = developerMode ? 
        "Error: Cannot undo selection. Process already initialized. *beep*" : 
        "Huh? No? You said yes earlier, so no leaving now.";
      tutorialCharacter.className = 'tutorial-character sarcastic';
      setCharacterImage('sarcastic');
      tutorialControls.innerHTML = '';
      const yesButton = document.createElement('button');
      yesButton.className = 'tutorial-button';
      yesButton.textContent = 'Yes';
      tutorialControls.appendChild(yesButton);
      yesButton.addEventListener('click', () => {
        tutorialContainer.classList.remove('active');
        gameContainer.style.display = 'block';
        if (isMobile) {
          touchControls.style.display = 'flex';
        }
        startPongGame();
      });
    }

    function showComment(text, emotion) {
      const now = Date.now();
      if (now - lastCommentTime < 2000) return;
      lastCommentTime = now;

      commentText.textContent = text;
      setCharacterImage(emotion, true);
      commentCharacter.className = `comment-character ${emotion}`;
      
      // Always use Hina Pon for comments, even in developer mode
      commentSpeaker.textContent = 'Hina Pon';
      commentCharacterImage.alt = 'Hina Pon';
      
      commentBox.classList.add('active');
      setTimeout(() => {
        if (!gameActive || commentBox.classList.contains('game-result')) {
          commentBox.classList.remove('active');
        }
      }, 1500);
    }

    function showGameResult(message, emotion) {
      commentBox.classList.add('game-result');
      showComment(message, emotion);
      setTimeout(() => {
        leaveGame();
        commentBox.classList.remove('game-result');
      }, 3000);
    }

    function getMoveComment(type) {
      const lowerName = playerName.toLowerCase();
      let comments;
      if (lowerName === 'sana') {
        comments = moveComments[type].sana;
      } else if (lowerName === 'rsvlt26') {
        comments = moveComments[type].rsvlt26;
      } else if (lowerName === 'aiden') {
        comments = moveComments[type].aiden;
      } else {
        comments = moveComments[type].default;
      }
      return comments[Math.floor(Math.random() * comments.length)];
    }

    function startPongGame() {
      gameActive = true;
      const containerWidth = gameContainer.offsetWidth;
      const containerHeight = gameContainer.offsetHeight;
      
      ballX = containerWidth / 2;
      ballY = containerHeight / 2;
      ballSpeedX = 5 * (Math.random() > 0.5 ? 1 : -1);
      ballSpeedY = 5 * (Math.random() * 2 - 1);
      playerPaddleY = containerHeight / 2;
      aiPaddleY = containerHeight / 2;
      playerScoreValue = 0;
      aiScoreValue = 0;
      playerScore.textContent = '0';
      aiScore.textContent = '0';
      lastBallX = ballX;

      updatePaddlePosition();
      updateBallPosition();
      
      commentBox.classList.add('active');
      
      clearInterval(gameInterval);
      gameInterval = setInterval(updateGame, 16);
    }

    function updateGame() {
      if (!gameActive) return;

      const containerWidth = gameContainer.offsetWidth;
      const containerHeight = gameContainer.offsetHeight;

      if (isMobile) {
        if (paddleMoveSpeed !== 0) {
          playerPaddleY += paddleMoveSpeed;
        } else {
          playerPaddleY = touchY;
        }
        updatePaddlePosition();
      }

      const prevBallX = ballX;
      ballX += ballSpeedX;
      ballY += ballSpeedY;
      updateBallPosition();

      // AI movement with modifiers
      let aiTargetY = ballY;
      let aiReactionSpeed = 0.05;
      let aiRandomFactor = 0;
      
      switch(botDifficulty) {
        case 1:
          aiReactionSpeed = 0.05 * aiDifficultyModifier;
          aiRandomFactor = 0.3 * aiRandomnessModifier;
          if (Math.random() > aiRandomFactor) {
            aiTargetY += (Math.random() * 100 - 50) * aiRandomnessModifier;
            aiPaddleY += (aiTargetY - aiPaddleY) * aiReactionSpeed * aiPrecisionModifier;
          }
          break;
        case 2:
          aiReactionSpeed = 1.0 * aiDifficultyModifier;
          aiRandomFactor = 0.1 * aiRandomnessModifier;
          aiTargetY = ballY - (isMobile ? 40 : 50) + (Math.random() * 40 - 20) * aiRandomFactor;
          aiPaddleY += (aiTargetY - aiPaddleY) * aiReactionSpeed * aiPrecisionModifier;
          break;
        case 3:
          aiReactionSpeed = 0.25 * aiDifficultyModifier;
          aiRandomFactor = 0.1 * aiRandomnessModifier;
          if (Math.random() > aiRandomFactor) {
            aiTargetY += (Math.random() * 20 - 10) * aiRandomnessModifier;
            aiPaddleY += (aiTargetY - aiPaddleY) * aiReactionSpeed * aiPrecisionModifier;
          }
          break;
      }

      if (aiPaddleY < 0) aiPaddleY = 0;
      if (aiPaddleY > containerHeight - (isMobile ? 80 : 100)) {
        aiPaddleY = containerHeight - (isMobile ? 80 : 100);
      }
      aiPaddle.style.top = aiPaddleY + 'px';

      if (ballY <= 0 || ballY >= containerHeight - (isMobile ? 15 : 20)) {
        ballSpeedY = -ballSpeedY;
      }

      const paddleWidth = isMobile ? 12 : 15;
      const paddleHeight = isMobile ? 80 : 100;
      const ballSize = isMobile ? 15 : 20;

      let playerHit = false;
      if (ballX <= 15 + paddleWidth &&
          ballX >= 15 &&
          ballY >= playerPaddleY - ballSize &&
          ballY <= playerPaddleY + paddleHeight) {
        playerHit = true;
        ballSpeedX = Math.abs(ballSpeedX) * (developerMode ? 1.15 : 1.1);
        const hitPosition = (ballY - playerPaddleY) / paddleHeight;
        ballSpeedY = 8 * (hitPosition - 0.5);
        ballX = 15 + paddleWidth;
        showComment(getMoveComment('hit'), 'happy');
      }

      if (ballX >= containerWidth - 15 - paddleWidth - ballSize &&
          ballX <= containerWidth - 15 &&
          ballY >= aiPaddleY - ballSize &&
          ballY <= aiPaddleY + paddleHeight) {
        ballSpeedX = -Math.abs(ballSpeedX) * (developerMode ? 1.15 : 1.1);
        const hitPosition = (ballY - aiPaddleY) / paddleHeight;
        ballSpeedY = 8 * (hitPosition - 0.5);
        ballX = containerWidth - 15 - paddleWidth - ballSize;
      }

      // Detect miss
      if (prevBallX > 15 + paddleWidth && ballX <= 15 + paddleWidth &&
          (ballY < playerPaddleY || ballY > playerPaddleY + paddleHeight)) {
        showComment(getMoveComment('miss'), 'nervous');
      }

      // Scoring
      if (ballX < 0) {
        aiScoreValue++;
        aiScore.textContent = aiScoreValue;
        aiScore.classList.add('bounce');
        setTimeout(() => aiScore.classList.remove('bounce'), 200);
        showComment(getMoveComment('concede'), 'nervous');
        resetBall();
        checkGameEnd();
      } else if (ballX > containerWidth) {
        playerScoreValue++;
        playerScore.textContent = playerScoreValue;
        playerScore.classList.add('bounce');
        setTimeout(() => playerScore.classList.remove('bounce'), 200);
        showComment(getMoveComment('score'), 'happy');
        resetBall();
        checkGameEnd();
      }
    }

    function checkGameEnd() {
      const maxScore = 5;
      if (playerScoreValue >= maxScore) {
        gameActive = false;
        clearInterval(gameInterval);
        showGameResult('Congratulations, you won!', 'happy');
      } else if (aiScoreValue >= maxScore) {
        gameActive = false;
        clearInterval(gameInterval);
        showGameResult('Oh no, the AI won!', 'nervous');
      }
    }

    function updatePaddlePosition() {
      const containerHeight = gameContainer.offsetHeight;
      const paddleHeight = isMobile ? 80 : 100;
      
      if (playerPaddleY < 0) {
        playerPaddleY = 0;
      } else if (playerPaddleY > containerHeight - paddleHeight) {
        playerPaddleY = containerHeight - paddleHeight;
      }
      playerPaddle.style.top = playerPaddleY + 'px';
    }

    function updateBallPosition() {
      ball.style.left = ballX + 'px';
      ball.style.top = ballY + 'px';
    }

    function resetBall() {
      const containerWidth = gameContainer.offsetWidth;
      const containerHeight = gameContainer.offsetHeight;
      
      ballX = containerWidth / 2;
      ballY = containerHeight / 2;
      ballSpeedX = 5 * (Math.random() > 0.5 ? 1 : -1);
      ballSpeedY = 5 * (Math.random() * 2 - 1);
      updateBallPosition();

      gameActive = false;
      setTimeout(() => {
        if (playerScoreValue < 5 && aiScoreValue < 5) {
          gameActive = true;
        }
      }, 1500);
    }

    function sanitizeInput(input) {
      return input.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }

    function setCharacterImage(emotion, isComment = false) {
      const imageElement = isComment ? commentCharacterImage : tutorialCharacterImage;
      
      // Always use Hina Pon for comments, even in developer mode
      if (isComment) {
        if (normalCharacterImageMap[emotion]) {
          imageElement.src = normalCharacterImageMap[emotion];
        } else {
          imageElement.src = normalCharacterImageMap.default;
        }
        return;
      }
      
      if (developerMode) {
        // Use developer mode character images (Hana Ponko) for tutorial only
        switch(emotion) {
          case 'serious':
          case 'explaining':
          case 'normal':
            imageElement.src = developerCharacterImageMap.serious;
            break;
          case 'happy':
          case 'excited':
            imageElement.src = developerCharacterImageMap.happy;
            break;
          case 'nervous':
          case 'scared':
            imageElement.src = developerCharacterImageMap.nervous;
            break;
          case 'flustered':
          case 'embarrassed':
            imageElement.src = developerCharacterImageMap.flustered;
            break;
          default:
            imageElement.src = developerCharacterImageMap.default;
        }
      } else {
        // Use normal mode character images (Hina Pon)
        if (normalCharacterImageMap[emotion]) {
          imageElement.src = normalCharacterImageMap[emotion];
        } else {
          imageElement.src = normalCharacterImageMap.default;
        }
      }
    }

    function updateCharacterName() {
      if (developerMode) {
        tutorialSpeaker.textContent = 'Hana Ponko';
        tutorialCharacterImage.alt = 'Hana Ponko';
      } else {
        tutorialSpeaker.textContent = 'Hina Pon';
        tutorialCharacterImage.alt = 'Hina Pon';
      }
      // Comments always use Hina Pon
      commentSpeaker.textContent = 'Hina Pon';
      commentCharacterImage.alt = 'Hina Pon';
    }

    function startGame() {
      playerName = sanitizeInput(playerNameInput.value.trim()) || 'Player';
      const lowerName = playerName.toLowerCase();

      if (lowerName === 'rsvlt26') {
        startScreen.classList.add('slide-out');
        setTimeout(() => {
          startScreen.style.display = 'none';
          showPasswordPrompt();
        }, 500);
      } else {
        startTutorial();
      }
    }

    function showPasswordPrompt() {
      tutorialContainer.classList.add('active');
      setTimeout(() => {
        tutorialDialogue.classList.add('active');
        tutorialText.style.animation = 'none';
        void tutorialText.offsetWidth;
        tutorialText.style.animation = 'textTyping 3s steps(40, end)';
        tutorialText.textContent = "Accessing Developer Mode requires a key. Think like a <div>-ine coder—don't console.log() your secrets! Your password should be as secure as !important in CSS, as dynamic as a Promise.resolve(), and as precise as a === strict check. No NaN business—only pure, unminified genius allowed. Enter the <!-- answer --> below:";
        tutorialCharacter.className = 'tutorial-character serious';
        setCharacterImage('serious');
        tutorialControls.style.display = 'none';
        passwordContainer.classList.add('active');
      }, 300);
    }

    function verifyPassword() {
      const password = passwordInput.value.trim();
      if (password === 'BYKVRELIA') {
        developerMode = true;
        document.body.classList.add('developer-mode');
        createMatrixRain();
        updateCharacterName();
        passwordContainer.classList.remove('active');
        errorMessage.classList.remove('active');
        tutorialControls.style.display = 'flex';
        if (!achievements.developerMode.unlocked) {
          achievements.developerMode.unlocked = true;
          updateAchievements();
        }
        startTutorial();
      } else {
        tutorialText.style.animation = 'none';
        void tutorialText.offsetWidth;
        tutorialText.style.animation = 'textTyping 3s steps(40, end)';
        tutorialText.textContent = "Wrong key, coder! Try again—no stack overflow allowed!";
        tutorialCharacter.className = 'tutorial-character nervous';
        setCharacterImage('nervous');
        errorMessage.classList.add('active');
        passwordInput.value = '';
        setTimeout(() => {
          errorMessage.classList.remove('active');
          showPasswordPrompt();
        }, 2000);
      }
    }

    function startTutorial() {
      playerName = sanitizeInput(playerNameInput.value.trim()) || 'Player';
      
      const lowerName = playerName.toLowerCase();
      const tutorialScript = developerMode ? developerTutorialScript : normalTutorialScript;
      
      if (lowerName === 'sana' || lowerName === 'sawna') {
        tutorialScript[0].text = "O-oh! H-hi Sana! Welcome to the tutorial!";
        tutorialScript[0].emotion = "nervous";
      } else if (lowerName === 'aiden') {
        tutorialScript[0].text = "A-Aiden?! *ahem* I mean... Welcome to the tutorial!";
        tutorialScript[0].emotion = "flustered";
      } else if (lowerName === 'rsvlt26') {
        tutorialScript[0].text = "Oh! Developer Mode activated! Welcome to the tutorial!";
        tutorialScript[0].emotion = "serious";
      }
      
      startScreen.classList.add('slide-out');
      setTimeout(() => {
        startScreen.style.display = 'none';
        showTutorial();
      }, 500);
    }

    function showTutorial() {
      updateCharacterName();
      tutorialContainer.classList.add('active');
      setTimeout(() => {
        tutorialDialogue.classList.add('active');
        updateTutorialStep();
      }, 300);
    }

    function updateTutorialStep() {
      const tutorialScript = developerMode ? developerTutorialScript : normalTutorialScript;
      
      if (currentTutorialStep >= tutorialScript.length) {
        endTutorial();
        return;
      }

      const step = tutorialScript[currentTutorialStep];
      
      tutorialText.style.animation = 'none';
      if (isCharacterHidden) {
        tutorialCharacter.className = 'tutorial-character hidden';
        if (step.emotion !== 'normal' && step.emotion !== 'explaining' && step.emotion !== 'serious') {
          tutorialCharacter.classList.add(step.emotion);
        }
      } else {
        tutorialCharacter.className = `tutorial-character`;
        if (step.emotion !== 'normal' && step.emotion !== 'explaining' && step.emotion !== 'serious') {
          tutorialCharacter.classList.add(step.emotion);
        }
      }
      setCharacterImage(step.emotion);
      void tutorialText.offsetWidth;
      
      tutorialText.style.animation = 'textTyping 3s steps(40, end)';
      
      let displayText = step.text;
      if (displayText.includes('{player}')) {
        displayText = displayText.replace('{player}', playerName);
      }
      
      const lineHeight = 1.5;
      const fontSize = parseFloat(getComputedStyle(tutorialText).fontSize);
      const lines = Math.ceil(displayText.length / 30);
      const minHeight = lines * lineHeight * fontSize;
      
      tutorialDialogue.style.minHeight = `${minHeight + 80}px`;
      
      tutorialText.textContent = displayText;
    }

    function endTutorial() {
      tutorialContainer.classList.remove('active');
      setTimeout(() => {
        mainContainer.style.display = 'flex';
        mainContainer.classList.add('slide-in');
      }, 300);
    }

    function toggleAchievements() {
      if (achievementsContainer.classList.contains('active')) {
        achievementsContainer.classList.remove('active');
      } else {
        updateAchievements();
        achievementsContainer.classList.add('active');
      }
    }

    function updateAchievements() {
      achievementList.innerHTML = '';
      for (let key in achievements) {
        const achievement = achievements[key];
        const achievementDiv = document.createElement('div');
        achievementDiv.className = 'achievement';
        achievementDiv.innerHTML = `
          <h3>${achievement.name}</h3>
          <p>${achievement.unlocked ? achievement.description : 'Locked'}</p>
        `;
        achievementList.appendChild(achievementDiv);
      }
    }

    tutorialNextButton.addEventListener('click', () => {
      currentTutorialStep++;
      updateTutorialStep();
    });

    initGame();
  </script>
</body>
</html>
